\section{Countermeasures to known attacks}
\label{sec:defenses}

As demonstrated in the previous section a manufacturer has to guard against a multitude of attacks. For designing effective defensive mechanisms one has to enumerate the likely attack scenarios and methods, type of attacker they will be facing and decide the type and extend of confidentiality they would like to provide\citep{sergei:thesis}\citep{kocher:DPA}.

A common first line of defense that is often encountered in attempts to secure systems, with questionable effectiveness, is security by obscurity and in the case of MCUs can be achieved in a number of different ways. As a starting point, the manufacturers can simply avoid printing their logos or model numbers on parts they produce, as this will make information gathering for he chip trickier. Some vendors take this even further by printing on their products identifiers of more secure or expensive products \footnote{Related legal issues discussed in Sec.~\ref{sec:conclussion}\red{hardware reveng legal issues}} or even try to make their MCUs look like ASICs \red{abbreviation?} in order to scare away potential attackers by making their product appear more secure\citep{sergei:thesis}. A further step in making the MCU harder to analyze is hardware obfuscation, where a group of gates commonly placed in well known structures for performing a given task (for example DES circuitry) is intentionally made more complicated and physically placed in a different locations or additional circuitry is added in order to thwart analysis\citep{anderson:cautionary_note}. Vendors also try to make information on their products hard to find by selling only to selected partners or under non-disclosure agreements\citep{sergei:thesis}.

Security through obscurity has received lots of criticism, and rightfully so, as it will do little to stop experienced or determined attackers. Despite its financial appeal a more effective approach is security in depth, a model in which information is protected by a number of (potentially) different defense mechanisms and in this scenario could be employed at different levels of the chip, from its external potting (or encasing) to its layered architecture. Given the attack categories presented in Sec.~\ref{sec:curr_attacks}, it would be useful to broadly categorize denfences in a similar fashion.

Non-invasive attacks are the least sophisticated type of attack but protection against them is a relatively laborious process\citep{anderson:cautionary_note}. To start with, one has to mask all the side-channel leakage and this means mask all relationships between data input and power consumption, thermal and electromagnetic radiation and timing relationships\citep{kocher:DPA}\cite{sergei:thesis}. Given the software release model and the power of MCUs it's not unreasonable to strive for efficiency, both in terms of consumption and components, and bytecode optimizations performed by compilers and the hardware architecture of the instruction pipeline of an MCU might introduce leakage \citep{kocher:DPA}\citep{sergei:thesis} by how branches are performed, instructions pre-fetched or not take constant time for operations. Even if constant time is taken for correct and erroneous keys such that timing relationships are masked, intermediate result storage is still a problem due to the fact that a 0 and a 1 consume different power when handled (due to the physical nature of CMOS transistors) and hence the power consumed in a given operation is proportional to the amount of 1 bits, a concept known as "Hamming weight"\citep{website:riscure}\citep{kocher:DPA}\red{maybe read this about CPA as well https://www.iacr.org/archive/ches2004/31560016/31560016.pdf }. Electromagnetic or thermal emission detection can be avoided by packaging that is appropriately shielded\citep{website:ibm_secure}\citep{kocher:DPA}. \red{also destroying circuitry and lock bits, lower operating voltages as well . insert random delays\citep{sergei:thesis}\citep{kocher:DPA}\citep{hwre}, \citep{kocher:DPA} <- read this to protect from DPA}\red{Power noise generation
 Threat: Power analysis
, Random number generator plus variable load
, Induce random power fluctuations to confuse
analysis
, Must be higher freq than sensitive power trace
and completely unpredictable}


also have self health tests to detect chip modification \citep{anderson:tamper_resistance}

Protection against invasive and non-invasive attacks is a lot harder because these attacks involve a range of chip modifications (from decapsulation to modification of the die), requiring varied anti-tampering mechanisms; we will proceed to give a description in the order in which decapsulation occurs. Thwarting decapsulation can get very creative as decapsulation is dependent on the material from which the chip packaging is made from (varied from pure plastic to ceramic or metal) and its physical construction. tries 

In order to protect from semi-invasive attacks (such as exposure to radiation or optical inspection-doping can also reduce light penetration to reduce imaging attacks \citep{sergei:thesis})

top metal conductive mesh, alert on power loss or short circuit (Atmel ATSHA204) 
conductive packaging and internal battery powered SRAM ,(instability reference \citep{anderson:cautionary_note}) optical sensors (\citep{sergei:thesis}, IBM reference, \citep{hwre}
glitch sensors (power/radiation/temperature/clock) - use of multiple clocks
metal circuitry ,
protective metal mesh on top of memories, 
Planarization defeats optical inspection with microscope \citep{sergei:thesis}.\\
moving lock bits around and introducing multiple lock bits\citep{sergei:thesis} careful placement \citep{hwre}
things also shrink

not perfect : give example for failure of oprical sensors
Scatter unshielded phototransistors around
Trigger when illuminated
May not detect laser glitching in a dark room

\subsection{Physical Protection}
asic glue logic design, protective metal-mesh layer, shrink things, mesh of wires, encase in epoxy, make layers destroy each other if removed. 
\subsubsection{Protection circuits}
 keep keys in own, self powered module.
	
	perhaps review some popular secure chips ?? IBM 4758 is a secure device \footnote{\href{http://www.cl.cam.ac.uk/~rnc1/descrack/ibm4758.html}{http://www.cl.cam.ac.uk/~rnc1/descrack/ibm4758.html}}, some Dallas chips and perhaps more.
	
	thermally enhanced packaging : makes difficult to microprobe chips as they need to be cooled or they'll fry [slides of hardware reveng module] and careful decaping needed
	
	ceramic packaging (Al2O3 is common, often mixed with SiO2, AlN and BeO) is extremely chemical resistant and seals very good, but can crack
	
	potting : protects board from environment[water/dirt] but might also make tampering harder and may need to be removed
	conformal coating : same deal as potting, but it's a thin layer that doesn't fill the enclosure but just covers the top.
	underfill : provides stability but gets in the way as well(makes desoldering harder).


Tamper responses
● Freeze (gate clock)
● Reset
● Self-destruct (erase firmware/data/keys)

● Flash erase
– Can be prevented
– Laser/FIB/etch out charge pump caps
– Cut/short write enable lines, HV outputs, etc
– No HV = no writes
● Zeroize battery-backed SRAM
– Much harder to prevent